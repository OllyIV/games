<!DOCTYPE html>
<html>
<section id="main">
    <title>Mowing</title>
    <h1 class="h1" style="margin:0">Mow the Lawn</h1>
    <p id="grass">Grass: 0</p>
    <p id="level" class="stat">Level: 0</p>
    <p id="prestige" class="stat">Prestige: 0</p>
    <progress id="exp" value="0" max="1"> 10% </progress>
    <p id='test'></p>
    <h1 id="error"></h1>
    <br>
    <button class="btn" onclick="openmodal('upgrades')">Upgrades</button>
    <button class="btn" onclick="openmodal('perks')">Perks</button>
    <button class="btn" onclick="openmodal('prestigemodal')">Prestige</button>
    <button class="btn" onclick="openmodal('customizemodal')">Customization</button>
    <button class="btn" onclick="openmodal('helpmodal')">Help & Stats</button>
    <br>
    <br>
    <div id="mainmodal">
        <div align="center" id="upgrades" class="modal">
            <button class="closebtn" onclick="closemodal('upgrades')">X</button>
            <br>
            <table class="modaltable">
                <tr>
                    <td><label id="grassvalueupgrade" class="label" for="grassvalue">Grass Value</label></td>
                    <td><input type="button" class="modalbtn" value="Upgrade" id="grassvalue" onclick="upgrade('grassvalue',5,1.2)"></td>
                </tr>
                <tr>
                    <td><label id="grasslimitupgrade" class="label" for="grasslimit">Grass Limit</label></td>
                    <td><input type="button" class="modalbtn" value="Upgrade" id="grasslimit" onclick="upgrade('grasslimit',1,1.3)"></td>
                </tr>
                <tr>
                    <td><label id="grassspawnupgrade" class="label" for="grassspawn">Grass Spawn Time</label></td>
                    <td><input type="button" class="modalbtn" value="Upgrade" id="grassspawn" onclick="upgrade('grassspawn',0.9,1.4)"></td>
                </tr>
                <tr>
                    <td><label id="expgainupgrade" class="label" for="expgain">Exp Gain</label></td>
                    <td><input type="button" class="modalbtn" value="Upgrade" id="expgain" onclick="upgrade('expgain',3,1.5)"></td>
                </tr>
            </table>
            <br>
        </div>
        <div align="center" id="perks" class="modal">
            <div class="modaltop">
                <h1 class="modalh1" align="center" id="perkpoints">Perk Points: 0</h1>
                <button class="closebtn" onclick="closemodal('perks')">X</button>
            </div>
            <br>
            <table class="modaltable">
                <tr>
                    <td><label class="label" for="grassvalueperk">Grass Value by 10%</label></td>
                    <td><p class="leveltext" id="grassvalueperklevel">Level: 0</p></td>
                    <td><input type="button" class="modalbtn" value="Upgrade (1 perk point)" id="grassvalueperk" onclick="perk('grassvalue',1.1,1)"></td>
                </tr>
                <tr>
                    <td><label class="label" for="grasslimitperk">Grass Limit by 10</label></td>
                    <td><p class="leveltext" id="grasslimitperklevel">Level: 0</p></td>
                    <td><input type="button" class="modalbtn" value="Upgrade (1 perk point)" id="grasslimitperk" onclick="perk('grasslimit',10,1)"></td>
                </tr>
                <tr>
                    <td><label class="label" for="grassspawnperk">Decrease Grass Spawn Time by 30%</label></td>
                    <td><p class="leveltext" id="grassspawnperklevel">Level: 0</p></td>
                    <td><input type="button" class="modalbtn" value="Upgrade (1 perk point)" id="grassspawnperk" onclick="perk('grassspawn',0.7,1)"></td>
                </tr>
                <tr>
                    <td><label class="label" for="expgainperk">Increase Exp Gain by 10%</label></td>
                    <td><p class="leveltext" id="expgainperklevel">Level: 0</p></td>
                    <td><input type="button" class="modalbtn" value="Upgrade (1 perk point)" id="expgainperk" onclick="perk('expgain',1.1,1)"></td>
                </tr>
                <tr>
                    <td><label class="label" for="mowerspeedperk">Increase Mower Speed by 1</label></td>
                    <td><p class="leveltext" id="mowerspeedperklevel">Level: 0</p></td>
                    <td><input type="button" class="modalbtn" value="Upgrade (10 perk points)" id="mowerspeedperk" onclick="perk('mowerspeed',1,10)"></td>
                </tr>
            </table>
            <br>
        </div>
        <div align="center" id="clearprompt" style="width:20%;height:20%" class="modal">
            <div class="modaltop">
                <h1 class="modalh1" align="center" style="margin:0" id="cleardata">Clear Data?</h1>
                <br>
                <br>
                <button class="btn" style="height:20%;background-color:green;" onclick="cleardata()">Yes</button>
                <button class="btn" style="height:20%;background-color:red;" onclick="closemodal('clearprompt')">No</button>
            </div>
            <br>
            <br>
        </div>
        <div align="center" id="helpmodal" class="modal" style="width:50%;height:70%;">
            <div class="modaltop">
                <h1 class="modalh1" align="center" id="helph1">Help</h1>
                <button class="closebtn" onclick="closemodal('helpmodal')">X</button>
            </div>
            <br>
            <div>
                <p style="color:#00aaff;font-size:100%;"><strong>Instructions:</strong> <br>To play, you can use the Left/Right arrows or A/D. You mow the grass, earn grass, and spend the grass to buy upgrades to get even more grass. When you level up, you earn a perk point. You can spend these in the Perks section. If you want to, you can clear your data to start over. (If you experience any problems, try updating the game version!)</p>
                <br>
                <p style="color:#00aaff;font-size:125%;"><strong></strong></p>
                <div style="background-color:#00aaff;width:50%;">
                    <h2 style="margin:0">Stats:</h2>
                    <p class="stattext" id="grassvaluestat">Grass Value: 5</p>
                    <p class="stattext" id="grasslimitstat">Grass Limit: 5</p>
                    <p class="stattext" id="grassspawnstat">Grass Spawn Time (In milliseconds): 5000</p>
                    <p class="stattext" id="expgainstat">Exp Gain: 3</p>
                    <p class="stattext" id="mowerspeedstat">Mower Speed: 3</p>
                    <p class="stattext" id="grassonscreen">Grass on screen: 0/5</p>
                    <p class="stattext" id="grassspawnamount">Grass Spawn Amount: 1</p>
                    <br>
                </div>
                <br>
                <br>
                <button class="btn" style="width:20%;height:10%;font-size:100%" onclick="update()">Update</button>
                <br>
                <br>
                <button class="btn" style="width:20%;height:10%;font-size:100%" onclick="cleardata()">Clear Data</button>
            </div>
        </div>
        <div align="center" id="prestigemodal" class="modal" style="width:50%;height:50%;">
            <div class="modaltop">
                <h1 class="modalh1" align="center" id="prestigeh1">Prestige</h1>
                <button class="closebtn" onclick="closemodal('prestigemodal')">X</button>
            </div>
            <br>
            <div>
                <p style="color:#00aaff;font-size:125%;">To Prestige, you must be at least level <span id="levelreq">100</span>.<br> Once you Prestige, you will gain more Perk Points and Grass in your next life.<br>
                    If you are ready to Prestige, click below.</p>
                <br>
                <button onclick="prestige()" class="btn">Prestige</button>
            </div>
        </div>
        <div align="center" id="customizemodal" class="modal" style="width:50%;height:50%;">
            <div class="modaltop">
                <h1 class="modalh1" align="center" id="customizeh1">Custmization</h1>
                <button class="closebtn" onclick="closemodal('customizemodal')">X</button>
            </div>
            <br>
            <p style="color:#00aaff;font-size:100%;">Lawn Mower Colors</p>
            <button id="red" class="color" style="background-color:red;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <button id="orange" class="color" style="background-color:orange;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <button id="yellow" class="color" style="background-color:yellow;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <button id="green" class="color" style="background-color:green;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <button id="blue" class="color" style="background-color:blue;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <button id="pink" class="color" style="background-color:pink;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <button id="purple" class="color" style="background-color:purple;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <button id="black" class="color" style="background-color:black;padding:1%;" onclick="changemowercolor(this.id)"></button>
            <br>
            <br>
            <p style="color:#00aaff;font-size:100%;">Engine Colors</p>
            <button id="red" class="color" style="background-color:red;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <button id="orange" class="color" style="background-color:orange;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <button id="yellow" class="color" style="background-color:yellow;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <button id="green" class="color" style="background-color:green;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <button id="blue" class="color" style="background-color:blue;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <button id="pink" class="color" style="background-color:pink;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <button id="purple" class="color" style="background-color:purple;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <button id="black" class="color" style="background-color:black;padding:1%;" onclick="changeenginecolor(this.id)"></button>
            <br>
            <br>
            <p style="color:#00aaff;font-size:100%;">Wheel & Stripe Colors</p>
            <button id="red" class="color" style="background-color:red;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <button id="orange" class="color" style="background-color:orange;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <button id="yellow" class="color" style="background-color:yellow;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <button id="green" class="color" style="background-color:green;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <button id="blue" class="color" style="background-color:blue;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <button id="pink" class="color" style="background-color:pink;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <button id="purple" class="color" style="background-color:purple;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <button id="black" class="color" style="background-color:black;padding:1%;" onclick="changewheelcolor(this.id)"></button>
            <br>
            <br>
            <p style="color:#00aaff;font-size:100%;">Handle Colors</p>
            <button id="red" class="color" style="background-color:red;padding:1%;" onclick="changehandlecolor(this.id)"></button>
            <button id="orange" class="color" style="background-color:orange;padding:1%;" onclick="changehandlecolor(this.id)"></button>
            <button id="yellow" class="color" style="background-color:yellow;padding:1%;" onclick="changehandlecolor(this.id)"></button>
            <button id="green" class="color" style="background-color:green;padding:1%;" onclick="changehandlecolor(this.id)"></button>
            <button id="blue" class="color" style="background-color:blue;padding:1%;" onclick="changehandlecolor(this.id)"></button>
            <button id="pink" class="color" style="background-color:pink;padding:1%;" onclick="changehandlecolor(this.id)"></button>
            <button id="purple" class="color" style="background-color:purple;padding:1%;" onclick="changehandlecolor(this.id)"></button>
            <button id="black" class="color" style="background-color:black;padding:1%;" onclick="changehandlecolor(this.id)"></button>
        </div>
    </div>
</section>
<hr style="margin:0;background-color:darkblue;height:1%;border:1px solid darkblue">
<canvas id="canvas" width="1500" height="500"></canvas>
</html>
<style>
    .stattext {
        font-size:100%;
    }
    #canvas {
        width:100%;
        height:50%;
    }
    #main {
        text-align:center;
        background-color:#87ceeb;
    }
    html {
        font-family: Arial;
        color:white;
    }
    .h1 {
        font-size:175%;
    }
    p {
        margin:0;
        font-size:100%;
    }
    .modaltable {
        border-spacing:10px;
    }
    .modalp > *{
        display:inline;
    }
    .leveltext {
        text-align:center;
        margin:0;
        font-family: Arial;
        font-size:100%;
        width:100%;
        background-color:#00aaff;
        color:white;
        border-radius:12px;
        padding:5%;
    }
    .closebtn {
        font-size:20px;
        top:0px;
        right:0px;
        float:right;
        transform: translate(65%,-50%);
        text-align:center;
        border-radius:12px;
        border: 1px solid #00aaff;
        background-color: #00aaff;
        color:white;
        width:10%;
        height:20%;
        transition: background-color .5s
    }
    .closebtn:hover {
        background-color: #4fc8ff
    }
    .modaltop > * {
        display:inline;;
    }
    .modalh1 {
        font-family: Arial;
        margin-left:10%;
        color:#00aaff;
    }
    .modal {
        color:white;
        border-radius:12px;
        font-size:100%;
        display:none;
        position:fixed;
        left: 50%;
        top:10%;
        transform: translate(-50%, 0);
        padding-right:.5%;
        padding-left:.5%;
        /*width:25%;
        height:20%;*/
        z-index:-1;
        background-color:#DEDEDE;
    }
    .stat {
        font-size:100%;
    }
    #mainmodal {
        display:none;
        position:fixed;
        top:0%;
        z-index:-1;
        right:0%;
        left:0%;
        width:100%;
        height:100%;
        background-color:rgba(0,0,0,0.3);
    }
    div {
        z-index:10;
    }
    .btn {
        font-size:100%;
        text-align:center;
        border-radius:4px;
        border: 1px solid #00aaff;
        background-color: #00aaff;
        color:white;
        width:19%;
        height:5%;
        transition: background-color .5s
    }
    .btn:hover {
        background-color: #4fc8ff
    }
    .modalbtn {
        font-size:125%;
        text-align:left;
        border-radius:4px;
        border: 1px solid #00aaff;
        background-color: #00aaff;
        color:white;
        width:100%;
        height:5%;
        transition: background-color .5s
    }
    .modalbtn:hover {
        background-color: #4fc8ff
    }
    .label {
        font-family: Arial;
        font-size:100%;
        color:#00aaff;
    }
    #grass {
        font-size:30px
    }
    #maindiv {
        height:100%;
        width:100%;
        text-align:center;
    }
    #lawn {
        width:80%;
        height:90%;
        border: 3px solid green;
        cursor: pointer;
    }
    #top {
        font-family: Arial;
        font-size:20px;
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">
    //try {
    const canvas = document.querySelector('canvas')
    const c = canvas.getContext("2d")
    const gravity = .5
    const subjects = ["grassvalue", "grassspawn", "grasslimit", "expgain", "mowerspeed"]
    const subjectkey = {
        "grassvalue": "Grass Value ",
        "grassspawn": "Grass Spawn Time ",
        "grasslimit": "Grass Limit ",
        "expgain": "Exp Gain ",
        "mowerspeed": "Increase Mower Speed by 1 "
    }
    const perkkey = {
        "grassvalue": "Grass Value by 10% ",
        "grassspawn": "Decrease Grass Spawn Time by 30% ",
        "grasslimit": "Grass Limit by 10 ",
        "expgain": "Increase Exp Gain by 10% ",
        "mowerspeed": "Increase Mower Speed by 25% "
    }
    let lastkey;
    /*update?
    if (localStorage.getItem('update')) {
        let updatestatus = localStorage.getItem('update')
    } else {
        let updatestatus = true
        localStorage.setItem('update',updatestatus)
    }
    if (updatestatus) {
        localStorage.clear()
        localStorage.setItem('update',false)
        updatestatus = localStorage.getItem('update')
    }
    */
    if (localStorage.getItem('mowerstats')) {
        var mowerstats = JSON.parse(localStorage.getItem('mowerstats'))
    } else {
        var mowerstats = {'grass': 0, 'grassvalue': 5, 'grassvaluecost': 10, 'grasslimit': 5, 'grasslimitcost': 15, 'grassspawn': 5000, 'grassspawncost': 50, 'grassspawnamount': 1, 'exp': 0, 'expgain': 3, 'expgaincost': 1000, 'neededexp': 50, 'level': 0, 'mowerspeed': 1, 'mowerspeedcost': 10000, 'perkpoints': 0, 'upgradelevels': {'grassvalue': 0, 'grasslimit': 0, 'grassspawn': 0, 'expgain': 0, 'mowerspeed': 0}, 'perkmultipliers': {'grassvalue': 1, 'grasslimit': 1, 'grassspawn': 1, 'expgain': 1, 'mowerspeed': 1},"perklevels": {'grassvalue': 0, 'grasslimit': 0, 'grassspawn': 0, 'expgain': 0, 'mowerspeed': 0}, "perkmax": {'grassvalue': 10000, 'grasslimit': 10, 'grassspawn': 25, 'expgain': 25, 'mowerspeed': 10}, 'prestige': {'prestigeamount': 0, 'prestigemultiplier': 1},'mowercolor':"red","wheelcolor":"black","handlecolor":"black","enginecolor":"black"}
        localStorage.setItem('mowerstats', JSON.stringify(mowerstats))
    }
    // try {
    //   var mowerstats = JSON.parse(localStorage.getItem('mowerstats'))
    //} catch {
    //var mowerstats = {'grass': 0, 'grassvalue': 5, 'grassvaluecost': 10, 'grasslimit': 5, 'grasslimitcost': 15, 'grassspawn': 5000, 'grassspawncost': 50, 'grassspawnamount': 1, 'exp': 0, 'expgain': 3, 'expgaincost': 1000, 'neededexp': 50, 'level': 0, 'mowerspeed': 1, 'mowerspeedcost': 10000, 'perkpoints': 0, 'upgradelevels': {'grassvalue': 0, 'grasslimit': 0, 'grassspawn': 0, 'expgain': 0, 'mowerspeed': 0}, 'perkmultipliers': {'grassvalue': 1, 'grasslimit': 1, 'grassspawn': 1, 'expgain': 1, 'mowerspeed': 1}, "perkmax": {'grassvalue': 10000, 'grasslimit': 10, 'grassspawn': 25, 'expgain': 25, 'mowerspeed': 5}, 'prestige': {'prestigeamount': 0, 'prestigemultiplier': 1},}
    //  localStorage.setItem('mowerstats', JSON.stringify(mowerstats))
    //}
    $("#grass").text("Grass: " + simplify(mowerstats.grass))
    for (var i = 0; i < subjects.length; i++) {
        let subjectstr = subjects[i] + 'cost'
        $("#" + subjects[i]).val("Upgrade (" + simplify(mowerstats[subjectstr]) + " Grass)")
        $("#" + subjects[i] + "upgrade").text(subjectkey[subjects[i]] + " (Level " + mowerstats.upgradelevels[subjects[i]] + ")")
    }
    /*$("#grassvalue").val("Upgrade ("+mowerstats.grassvaluecost+" Grass)")
    $("#grassspawn").val("Upgrade ("+mowerstats.grassspawncost+" Grass)")
    $("#grasslimit").val("Upgrade ("+mowerstats.grasslimitcost+" Grass)")
    $("#expgain").val("Upgrade ("+mowerstats.expgaincost+" Grass)")
    $("#mowerspeed").val("Upgrade ("+mowerstats.mowerspeedcost+" Grass)")*/
    $("#exp").val(mowerstats.exp / mowerstats.neededexp)
    $("#level").text("Level: " + mowerstats.level)
    $("#prestige").text("Prestige: " + mowerstats.prestige.prestigeamount)
    $("#perkpoints").text("Perk Points: " + mowerstats.perkpoints)
    $("#levelreq").text(100 + mowerstats.prestige.prestigeamount * 25)
    for (var i in mowerstats.perklevels) {
        if (mowerstats.perklevels[[i]] === mowerstats.perkmax[[i]]) {
            $("#" + i + "perklevel").text("Level: " + mowerstats.perklevels[i] + " (Max)")
        } else {
            $("#" + i + "perklevel").text("Level: " + mowerstats.perklevels[i] + "")
        }
    }
    let keys = {
        a: {
            pressed: false
        },
        d: {
            pressed: false
        },
        w: {
            pressed: false
        }
    }
    let currentgrass = 0

    function update() {
        const tempmowerstats = mowerstats
        mowerstats = {'grass': 0, 'grassvalue': 5, 'grassvaluecost': 10, 'grasslimit': 5, 'grasslimitcost': 15, 'grassspawn': 5000, 'grassspawncost': 50, 'grassspawnamount': 1, 'exp': 0, 'expgain': 3, 'expgaincost': 1000, 'neededexp': 50, 'level': 0, 'mowerspeed': 1, 'mowerspeedcost': 10000, 'perkpoints': 0, 'upgradelevels': {'grassvalue': 0, 'grasslimit': 0, 'grassspawn': 0, 'expgain': 0, 'mowerspeed': 0}, 'perkmultipliers': {'grassvalue': 1, 'grasslimit': 1, 'grassspawn': 1, 'expgain': 1, 'mowerspeed': 1},"perklevels": {'grassvalue': 0, 'grasslimit': 0, 'grassspawn': 0, 'expgain': 0, 'mowerspeed': 0}, "perkmax": {'grassvalue': 10000, 'grasslimit': 10, 'grassspawn': 25, 'expgain': 25, 'mowerspeed': 10}, 'prestige': {'prestigeamount': 0, 'prestigemultiplier': 1},"mowercolor":"red","wheelcolor":"black","enginecolor":"black"}
        Object.keys(tempmowerstats).forEach(key => {
            mowerstats[key] = tempmowerstats[key]
        })
        //var desiredupdatevariables = {"grassspawnamount": 1 + tempmowerstats.prestigeamount}
        /*Object.keys(tempmowerstats).forEach(key => {
            console.log(key+": "+tempmowerstats[key]+" key")
                Object.keys(tempmowerstats[key]).forEach(smallkey => {
                    if (smallkey in mowerstats) {
                        console.log(smallkey + ": " + mowerstats[key][smallkey])
                    }
                })
            })*/
        /*for (var i=0;i<desiredupdatevariables.length;i++) {
            if (! desiredupdatevariables[i] in mowerstats) {
                mowerstats.push({
                    desiredupdatevariables[i]:
                })
            }
        }
        Object.entries(desiredupdatevariables).forEach(entry => {
            let [key, value] = entry;
            console.log("entries worked")
            if (key in mowerstats) {

            } else {
                mowerstats[key] = value
                console.log("it worked!")
            }
        })*/
        localStorage.setItem('mowerstats', JSON.stringify(mowerstats))
        window.location.reload()
    }

    function upgrade(subject, subjectmultiplier, costmultiplier) {
        mowerstats.grass = parseFloat(mowerstats.grass)
        if (mowerstats.grass >= parseFloat(mowerstats[subject + "cost"])) {
            var strsubjectmultiplier = "" + subjectmultiplier
            if (strsubjectmultiplier.includes(".")) {
                var operation = "*"
            } else {
                var operation = "+"
            }
            if (operation == "+") {
                mowerstats[subject] += subjectmultiplier
            } else if (operation == "*") {
                mowerstats[subject] *= subjectmultiplier
            }
            if (subject !== "grassspawn") {
                mowerstats[subject] += mowerstats.prestige.prestigeamount
            }
            mowerstats.grass -= mowerstats[subject + "cost"]
            mowerstats.grass = mowerstats.grass.toFixed(2)
            mowerstats.grass = parseFloat(mowerstats.grass)
            $("#grass").text("Grass: " + simplify(mowerstats.grass))
            mowerstats.upgradelevels[subject] += 1
            $("#" + subject + "upgrade").text(subjectkey[subject] + "(Level: " + mowerstats.upgradelevels[subject] + ")")
            mowerstats[subject + "cost"] *= costmultiplier
            mowerstats[subject + "cost"] = mowerstats[subject + "cost"].toFixed(2)
            $("#" + subject).val("Upgrade (" + simplify(mowerstats[subject + "cost"]) + " Grass)")
            localStorage.setItem('mowerstats', JSON.stringify(mowerstats))
            clearInterval(grassdictinterval)
            grassdictinterval = setInterval(generategrass, mowerstats.grassspawn)
        }
    }

    function perk(subject, subjectmultiplier, perkcost) {
        if (mowerstats.perkpoints >= perkcost && mowerstats.perklevels[subject] < mowerstats.perkmax[subject]) {
            var strsubjectmultiplier = "" + subjectmultiplier
            if (strsubjectmultiplier.includes(".")) {
                var operation = "*"
            } else {
                var operation = "+"
            }
            if (operation == "+") {
                mowerstats[subject] += subjectmultiplier
            } else if (operation == "*") {
                mowerstats[subject] /= mowerstats.perkmultipliers[subject]
                mowerstats.perkmultipliers[subject] *= subjectmultiplier;
                mowerstats[subject] *= mowerstats.perkmultipliers[subject]
            }
            mowerstats.perkpoints -= perkcost;
            mowerstats.perklevels[subject] += 1
            $("#perkpoints").text("Perk Points: " + mowerstats.perkpoints)
            if (mowerstats.perklevels[subject] >= mowerstats.perkmax[subject]) {
                $("#" + subject + "perklevel").text("Level: " + mowerstats.perklevels[subject] + " (Max)")
            } else {
                $("#" + subject + "perklevel").text("Level: " + mowerstats.perklevels[subject])
            }
            localStorage.setItem('mowerstats', JSON.stringify(mowerstats))
            clearInterval(grassdictinterval)
            grassdictinterval = setInterval(generategrass, mowerstats.grassspawn)
        }
    }

    var statupdater = setInterval(function () {
        try {
            $("#grassvaluestat").text("Grass Value: " + (mowerstats.grassvalue * mowerstats.prestige.prestigemultiplier).toFixed(2) + "")
            $("#grassspawnstat").text("Grass Spawn Time: " + parseFloat(mowerstats.grassspawn / 1000).toFixed(3) + "s")
            $("#grasslimitstat").text("Grass Limit: " + mowerstats.grasslimit + "")
            $("#expgainstat").text("Exp Gain: " + (mowerstats.expgain * mowerstats.perkmultipliers.expgain).toFixed(2) + "")
            $("#mowerspeedstat").text("Mower Speed: " + parseFloat(mowerstats.mowerspeed + 2).toFixed(2) + "")
            if (isNaN(parseInt(mowerstats.grassspawnamount))) {
                $("#error").text("Your version of the game is not up to date. Please update your game version in the Help Menu.")
            } else {
                $("#grassspawnamount").text("Grass Spawn Amount: " + parseInt(mowerstats.grassspawnamount))
            }
            let grassamount = 0
            for (var i = 0; i < Object.keys(grassdict).length + 1; i++) {
                grassamount = i
            }
            $("#grassonscreen").text("Grass on screen: " + grassamount + "/" + mowerstats.grasslimit)
        } catch (err) {
            $("#error").text("Your version of the game is not up to date. Please update your game version in the Help Menu.")
        }
    }, 1)

    function openmodal(id) {
        $("#mainmodal").css('display', "inline")
        $("#mainmodal").css('z-index', '100')
        $("#" + id).css('z-index', '100')
        $("#" + id).css('display', 'inline')
    }

    function closemodal(id) {
        $("#mainmodal").css('display', "none")
        $("#mainmodal").css('z-index', '-1')
        $("#" + id).css('z-index', '-1')
        $("#" + id).css('display', 'none')
    }

    function cleardata() {
        try {
            player.position.y = 500
        } catch {
            console.log("Not updated bruh")
        }
        localStorage.clear()
        window.location.reload()
    }
    function prestige() {
        //mowerstats.prestige.prestigeamount += 1
        //mowerstats.prestige.prestigemultiplier += mowerstats.level / 2
        try {
            if (mowerstats.level >= 100 + (mowerstats.prestige.prestigeamount * 25)) {
                player.position.y = 0;
                let tempprestigemultiplier = mowerstats.prestige.prestigemultiplier
                if (tempprestigemultiplier == 1) {
                    tempprestigemultiplier += (mowerstats.level / 50) - 1
                } else {
                    tempprestigemultiplier += (mowerstats.level / 50)
                }
                let tempprestiges = mowerstats.prestige.prestigeamount + 1
                mowerstats = {'grass': 0, 'grassvalue': 5, 'grassvaluecost': 10, 'grasslimit': 5, 'grasslimitcost': 15, 'grassspawn': 5000, 'grassspawncost': 50, 'grassspawnamount': 1 + tempprestiges, 'exp': 0, 'expgain': 3, 'expgaincost': 1000, 'neededexp': 50, 'level': 0, 'mowerspeed': 1, 'mowerspeedcost': 10000, 'perkpoints': tempprestiges * 2, 'upgradelevels': {'grassvalue': 0, 'grasslimit': 0, 'grassspawn': 0, 'expgain': 0, 'mowerspeed': 0}, 'perkmultipliers': {'grassvalue': 1, 'grasslimit': 1, 'grassspawn': 1, 'expgain': 1, 'mowerspeed': 1},"perklevels": {'grassvalue': 0, 'grasslimit': 0, 'grassspawn': 0, 'expgain': 0, 'mowerspeed': 0}, "perkmax": {'grassvalue': 10000 * (tempprestiges + 1), 'grasslimit': 10 + ( 10 * (tempprestiges + 1)), 'grassspawn': 25 + ( 10 * (tempprestiges + 1)), 'expgain': 25 + ( 10 * (tempprestiges + 1)), 'mowerspeed': 10}, 'prestige': {'prestigeamount': tempprestiges, 'prestigemultiplier': tempprestigemultiplier},"mowercolor":mowerstats.mowercolor,"wheelcolor":mowerstats.wheelcolor,"handlecolor":mowerstats.handlecolor,"enginecolor":mowerstats.enginecolor}
                localStorage.setItem('mowerstats', JSON.stringify(mowerstats))
                window.location.reload()
            }
        } catch (err) {
            $("#error").text("There's a bug. Your version of the game may not be up to date Please update your game version in the Help Menu.")
        }
    }
    function simplify(numb) {
        var str = numb.toString().split(".");
        str[0] = str[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return str.join(".");
    }
    function changemowercolor(color) {
        mowerstats.mowercolor = color;
        localStorage.setItem('mowerstats',mowerstats)
    }
    function changewheelcolor(color) {
        mowerstats.wheelcolor = color;
        localStorage.setItem('mowerstats',mowerstats)
    }
    function changehandlecolor(color) {
        mowerstats.handlecolor = color;
        localStorage.setItem('mowerstats',mowerstats)
    }
    function changeenginecolor(color) {
        mowerstats.enginecolor = color;
        localStorage.setItem('mowerstats',mowerstats)
    }
    c.fillRect(0, 0, canvas.width, canvas.height)
    class Grass {
        constructor({position, maxheight}) {
            this.position = position
            this.maxheight = maxheight //-1 * canvas.height/5
            this.width = 25
            this.currentheight = 0
        }

        draw() {
            if (this.currentheight > this.maxheight) {
                this.currentheight -= 2
            }
            c.fillStyle = "green"
            c.fillRect(this.position.x, this.position.y, this.width, this.currentheight)
        }

        update() {
            this.draw()
        }
    }

    class Sprite {
        constructor({position, velocity}) {
            this.position = position
            this.velocity = velocity
            this.height = 200
            this.width = 100
            this.scythebox = {
                //position: this.position,
                position: {
                    x: this.position.x,
                    y: this.position.y
                },
                width: this.width + this.width,
                height: this.height / 2,
            }
            this.wheels = {
                leftwheel: {
                    position: {
                        x: this.position.x,
                        y: this.position.y,
                    },
                    width: this.width / 2,
                    height: this.height / 3
                },
                rightwheel: {
                    position: {
                        x: this.position.x + 50,
                        y: this.position.y + 50,
                    },
                    width: this.width / 2,
                    height: this.height / 3
                },
            }
        }

        draw() {
            c.fillStyle = mowerstats.enginecolor
            c.fillRect(this.position.x, this.position.y, this.width, this.height)
            //scythe
            c.fillStyle = mowerstats.mowercolor
            c.fillRect(this.scythebox.position.x, this.scythebox.position.y, this.scythebox.width, this.scythebox.height)
            //wheels
            c.fillStyle = mowerstats.wheelcolor
            c.fillRect(this.wheels.rightwheel.position.x, this.wheels.rightwheel.position.y, this.wheels.rightwheel.width, this.wheels.rightwheel.height)
            c.fillStyle = mowerstats.wheelcolor
            c.fillRect(this.wheels.leftwheel.position.x, this.wheels.leftwheel.position.y, this.wheels.leftwheel.width, this.wheels.leftwheel.height)
            //c.fillStyle = "blue"
            //c.fillRect(this.scythebox.trackposition.x,this.scythebox.trackposition.y,this.scythebox.width,this.scythebox.height)
            c.beginPath()
            c.lineWidth = 20
            c.strokeStyle = mowerstats.handlecolor
            if (lastkey === "d" || lastkey === "ArrowRight") {
                //c.moveTo(this.position.x - 150, this.position.y - 150);
                //c.lineTo(this.position.x + 10, this.position.y + 10);
                c.moveTo(this.position.x - 200, this.position.y - 50);
                c.lineTo(this.position.x - 25, this.position.y + this.height / 2 + 10);
                c.stroke();
                c.moveTo(this.position.x - 250, this.position.y - 50);
                c.lineTo(this.position.x - 194, this.position.y - 50);
                c.stroke()
            } else {
                //c.moveTo(this.position.x + this.width * 2 + 50, this.position.y - 150);
                //c.lineTo(this.position.x + this.width - 10, this.position.y + 10);
                c.moveTo(this.position.x + this.width * 2 + 100, this.position.y - 50);
                c.lineTo(this.position.x + this.width + 25, this.position.y + this.height / 2 + 10);
                c.stroke();
                c.moveTo(this.position.x + this.width * 2 + 94, this.position.y - 50);
                c.lineTo(this.position.x + this.width * 2 + 150, this.position.y - 50);
                c.stroke()
            }
            c.lineWidth = 5
            c.strokeStyle = mowerstats.wheelcolor
            c.moveTo(this.position.x - this.width/2,this.position.y + this.height/2 + 25)
            c.lineTo(this.position.x + (this.width * 1.5) ,this.position.y + this.height/2 + 25)
            c.stroke();
            c.moveTo(this.position.x - this.width/2,this.position.y + this.height/2 + 35)
            c.lineTo(this.position.x + (this.width * 1.5) ,this.position.y + this.height/2 + 35)
            c.stroke();
        }

        update() {
            this.draw()
            this.position.x += this.velocity.x
            this.position.y += this.velocity.y
            if (this.position.y + this.height + this.velocity.y >= canvas.height - 100) {
                this.velocity.y = 0
            } else {
                this.velocity.y += gravity
            }
            this.position.x += this.velocity.x
            if (this.position.x + this.velocity.x >= canvas.width) {
                this.position.x = 0
            } else if (this.position.x + this.velocity.x <= 0) {
                this.position.x = canvas.width
            }
            /*if (lastkey === "a") {
                this.scythebox.position.x = this.position.x - this.width/2 //- this.width * 2 //+ this.width / 2
                this.scythebox.position.y = this.position.y + this.height - this.height / 2
            } else {
                this.scythebox.position.x = this.position.x - this.width + this.width/2
                this.scythebox.position.y = this.position.y + this.height - this.height / 2
            }*/
            this.scythebox.position.x = this.position.x - this.width + this.width / 2
            this.scythebox.position.y = this.position.y + this.height - this.height / 2
            this.wheels.rightwheel.position.x = this.position.x + this.width - 10
            this.wheels.rightwheel.position.y = this.position.y + this.height - this.height / 4
            this.wheels.leftwheel.position.x = this.position.x - this.width + this.width / 2 + 10
            this.wheels.leftwheel.position.y = this.position.y + this.height - this.height / 4
        }
    }
    let player = new Sprite({
        position: {
            x: canvas.width / 2 - 50,
            y: canvas.height / 2,
        },
        velocity: {
            x: 0,
            y: 2
        }
    })
    let grassdict = {};
    let grassdictcounter = 0
    var grassdictinterval = setInterval(generategrass, mowerstats.grassspawn)

    function generategrass() {
        if (currentgrass < mowerstats.grasslimit) {
            for (var i = 0; i < mowerstats.grassspawnamount; i++) {
                var randomx = Math.ceil(Math.random() * canvas.width)
                var randomheight = -1 * (Math.ceil((Math.random() * 200) + 100))
                grassdict[grassdictcounter] = new Grass({
                    position: {
                        x: randomx,
                        y: (canvas.height - canvas.height / 10)
                    },
                    maxheight: randomheight,
                })
                grassdictcounter++
                currentgrass++
            }
        }
    }

    function animate() {
        window.requestAnimationFrame(animate)
        c.fillStyle = "#87ceeb"
        c.fillRect(0, 0, canvas.width, canvas.height)
        c.fillStyle = "lightgreen"
        c.fillRect(0, (canvas.height) - (canvas.height / 10), canvas.width, (canvas.height) - (canvas.height / 10))
        player.update()
        Object.keys(grassdict).forEach(key => {
            grassdict[key].update()
        })
        /*for (var i = 0;i<Object.keys(grassdict).length-1;i++) {
            grassdict[i].update()
        }*/
        player.velocity.x = 0
        if (keys.a.pressed && lastkey === "a") {
            player.velocity.x = -2
            player.velocity.x -= mowerstats.mowerspeed
        } else if (keys.a.pressed && lastkey === "ArrowLeft") {
            player.velocity.x = -2
            player.velocity.x -= mowerstats.mowerspeed
        } else if (keys.d.pressed && lastkey === "d") {
            player.velocity.x = 2
            player.velocity.x += mowerstats.mowerspeed
        } else if (keys.d.pressed && lastkey === "ArrowRight") {
            player.velocity.x = 2
            player.velocity.x += mowerstats.mowerspeed
        }
        //grass collision
        Object.keys(grassdict).forEach(key => {
            if (player.scythebox.position.x + player.scythebox.width >= grassdict[key].position.x && player.scythebox.position.x <= grassdict[key].position.x + grassdict[key].width && player.scythebox.height >= grassdict[key].currentheight) {
                c.fillStyle = "#87ceeb"
                c.fillRect(grassdict[key].position.x, grassdict[key].position.y, grassdict[key].width, grassdict[key].currentheight)
                if (key == 0) {
                    delete grassdict[0]
                } else {
                    delete grassdict[key]
                }
                //test
                mowerstats.grass = parseFloat(mowerstats.grass)
                mowerstats.grass += parseFloat(mowerstats.grassvalue * mowerstats.prestige.prestigemultiplier)
                mowerstats.grass = parseFloat(mowerstats.grass).toFixed(2)
                mowerstats.exp += parseFloat(mowerstats.expgain * mowerstats.perkmultipliers.expgain)
                if (mowerstats.exp >= mowerstats.neededexp) {
                    mowerstats.exp = 0
                    mowerstats.level += 1
                    mowerstats.perkpoints += 1
                    $("#level").text("Level: " + mowerstats.level)
                    $("#perkpoints").text("Perk Points: " + mowerstats.perkpoints)
                    mowerstats.neededexp *= 1.1
                }
                currentgrass--
                $("#exp").val(mowerstats.exp / mowerstats.neededexp)
                $("#grass").text("Grass: " + simplify(mowerstats.grass))
                localStorage.setItem('mowerstats', JSON.stringify(mowerstats))
            }
        })
        /*for (var i = 0;i<Object.keys(grassdict).length-1;i++) {
            if (player.scythebox.position.x + player.scythebox.width >= grassdict[i].position.x && player.scythebox.position.x <= grassdict[i].position.x + grassdict[i].width) {
                console.log("Hit grassdict: "+i)
                c.fillStyle = "#87ceeb"
                c.fillRect(grassdict[i].position.x,grassdict[i].position.y,grassdict[i].width,grassdict[i].maxheight)
                if (i == 0) {
                    delete grassdict[0]
                } else {
                    delete grassdict[i]
                }
            }
        }*/

    }

    window.addEventListener("keydown", (e) => {
        switch (e.key) {
            case "d":
                keys.d.pressed = true
                lastkey = "d"
                break
            case "ArrowRight":
                keys.d.pressed = true
                lastkey = "ArrowRight"
                break
            case "a":
                keys.a.pressed = true
                lastkey = "a"
                break
            case "ArrowLeft":
                keys.a.pressed = true
                lastkey = "ArrowLeft"
                break
        }
    })
    window.addEventListener("keyup", (e) => {
        switch (e.key) {
            case "d":
                keys.d.pressed = false
            case "a":
                keys.a.pressed = false
                break
            case "ArrowLeft":
                keys.a.pressed = false
                lastkey = "ArrowLeft"
                break
            case "ArrowRight":
                keys.d.pressed = false
                lastkey = "ArrowRight"
                break
        }
    })
    window.onload = function () {
        animate()
    }
    //} catch {
    //$("#error").text("Error: There is a bug/storage problem. Please update your version of the game in the Help Menu. If that doesn't work, something's wrong.")
    //}
</script>